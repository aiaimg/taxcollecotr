{% extends "base_admin_velzon.html" %}
{% load static %}
{% load i18n %}

{% block title %}Supprimer {{ object.plaque_immatriculation }} - Confirmation{% endblock %}

{% block extra_css %}
<style>
    .delete-header {
        background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
    }
    .warning-card {
        border-left: 5px solid #dc3545;
        background: #fff5f5;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .vehicle-info-card {
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 30px;
        margin-bottom: 20px;
    }
    .info-item {
        padding: 15px;
        border-left: 4px solid #405189;
        background: #f8f9fa;
        margin-bottom: 15px;
        border-radius: 0 10px 10px 0;
    }
    .danger-zone {
        background: #fff5f5;
        border: 2px solid #dc3545;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
    }
    .btn-danger-custom {
        background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .btn-danger-custom:hover {
        background: linear-gradient(135deg, #e63946 0%, #f77f00 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }
</style>
{% endblock %}

{% block pagetitle %}
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">
                <i class="ri-delete-bin-line me-2"></i>Supprimer le Véhicule
            </h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="{% url 'administration:dashboard' %}">Tableau de Bord</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'administration:individual_vehicle_list' %}">Véhicules Individuels</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'administration:individual_vehicle_detail' plaque=object.plaque_immatriculation %}">{{ object.plaque_immatriculation }}</a></li>
                    <li class="breadcrumb-item active">Supprimer</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Delete Header -->
<div class="delete-header">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h2 class="mb-2">
                <i class="ri-alert-line me-2"></i>Confirmation de Suppression
            </h2>
            <p class="mb-0 opacity-75">
                Vous êtes sur le point de supprimer définitivement ce véhicule
            </p>
        </div>
        <div class="col-lg-4 text-lg-end">
            <i class="ri-delete-bin-line display-1 opacity-50"></i>
        </div>
    </div>
</div>

<!-- Warning Messages -->
<div class="warning-card">
    <div class="d-flex align-items-start">
        <i class="ri-error-warning-line text-danger fs-2 me-3"></i>
        <div>
            <h5 class="text-danger mb-2">⚠️ Attention - Action Irréversible</h5>
            <p class="mb-2">
                <strong>Cette action est définitive et ne peut pas être annulée.</strong> 
                La suppression de ce véhicule entraînera :
            </p>
            <ul class="mb-0">
                <li>La suppression définitive de toutes les données du véhicule</li>
                <li>La perte de l'historique des paiements associés</li>
                <li>La suppression des liens avec les déclarations fiscales</li>
                <li>L'impossibilité de récupérer ces informations</li>
            </ul>
        </div>
    </div>
</div>

<!-- Vehicle Information -->
<div class="vehicle-info-card">
    <h5 class="mb-4">
        <i class="ri-information-line me-2"></i>Informations du Véhicule à Supprimer
    </h5>
    
    <div class="row">
        <div class="col-lg-6">
            <div class="info-item">
                <strong>Plaque d'Immatriculation</strong><br>
                <span class="text-primary fs-5">{{ object.plaque_immatriculation }}</span>
            </div>
            
            <div class="info-item">
                <strong>Propriétaire</strong><br>
                <span class="text-info">{{ object.proprietaire.get_full_name|default:object.proprietaire.username }}</span><br>
                <small class="text-muted">{{ object.proprietaire.email }}</small>
            </div>
            
            <div class="info-item">
                <strong>Puissance Fiscale</strong><br>
                <span class="text-primary">{{ object.puissance_fiscale_cv }} CV</span>
            </div>
            
            <div class="info-item">
                <strong>Statut</strong><br>
                <span class="badge {% if object.est_actif %}bg-success{% else %}bg-danger{% endif %}">
                    {% if object.est_actif %}Actif{% else %}Inactif{% endif %}
                </span>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="info-item">
                <strong>Cylindrée</strong><br>
                <span class="text-primary">{{ object.cylindree_cm3 }} cm³</span>
            </div>
            
            <div class="info-item">
                <strong>Source d'Énergie</strong><br>
                <span class="text-info">{{ object.get_source_energie_display }}</span>
            </div>
            
            <div class="info-item">
                <strong>Catégorie</strong><br>
                <span class="badge bg-primary">{{ object.get_categorie_vehicule_display }}</span>
            </div>
            
            <div class="info-item">
                <strong>Type</strong><br>
                <span class="badge bg-info">{{ object.get_type_vehicule_display }}</span>
            </div>
        </div>
    </div>
    
    {% if object.date_premiere_circulation %}
    <div class="row mt-3">
        <div class="col-12">
            <div class="info-item">
                <strong>Date Première Circulation</strong><br>
                <span class="text-muted">{{ object.date_premiere_circulation|date:"d/m/Y" }}</span>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if object.specifications_techniques %}
    <div class="row mt-3">
        <div class="col-12">
            <div class="info-item">
                <strong>Spécifications Techniques</strong><br>
                <div class="text-muted">{{ object.specifications_techniques|linebreaks }}</div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="row mt-3">
        <div class="col-lg-6">
            <div class="info-item">
                <strong>Date de Création</strong><br>
                <span class="text-muted">{{ object.created_at|date:"d/m/Y à H:i" }}</span>
            </div>
        </div>
        {% if object.updated_at %}
        <div class="col-lg-6">
            <div class="info-item">
                <strong>Dernière Modification</strong><br>
                <span class="text-muted">{{ object.updated_at|date:"d/m/Y à H:i" }}</span>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Danger Zone -->
<div class="danger-zone">
    <i class="ri-delete-bin-line display-1 text-danger mb-3"></i>
    <h4 class="text-danger mb-3">Zone de Suppression</h4>
    <p class="mb-4">
        Pour confirmer la suppression, veuillez taper <strong>"{{ object.plaque_immatriculation }}"</strong> 
        dans le champ ci-dessous :
    </p>
    
    <form method="post" id="deleteForm">
        {% csrf_token %}
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="mb-3">
                    <input type="text" class="form-control form-control-lg text-center" 
                           id="confirmationInput" placeholder="Tapez la plaque d'immatriculation"
                           autocomplete="off">
                    <div class="invalid-feedback" id="confirmationError">
                        La plaque d'immatriculation ne correspond pas
                    </div>
                </div>
                
                <div class="d-flex justify-content-center gap-3">
                    <button type="submit" class="btn btn-danger-custom btn-lg" id="deleteButton" disabled>
                        <i class="ri-delete-bin-line me-2"></i>Supprimer Définitivement
                    </button>
                    <a href="{% url 'administration:individual_vehicle_detail' plaque=object.plaque_immatriculation %}" 
                       class="btn btn-secondary btn-lg">
                        <i class="ri-arrow-left-line me-2"></i>Annuler
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Alternative Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6><i class="ri-lightbulb-line me-2"></i>Alternatives à la Suppression</h6>
            <p class="mb-2">Avant de supprimer définitivement ce véhicule, considérez ces alternatives :</p>
            <div class="d-flex flex-wrap gap-2">
                {% if object.est_actif %}
                <a href="{% url 'administration:individual_vehicle_update' plaque=object.plaque_immatriculation %}" 
                   class="btn btn-outline-warning btn-sm">
                    <i class="ri-close-circle-line me-1"></i>Désactiver le véhicule
                </a>
                {% else %}
                <a href="{% url 'administration:individual_vehicle_update' plaque=object.plaque_immatriculation %}" 
                   class="btn btn-outline-success btn-sm">
                    <i class="ri-checkbox-circle-line me-1"></i>Réactiver le véhicule
                </a>
                {% endif %}
                <a href="{% url 'administration:individual_vehicle_update' plaque=object.plaque_immatriculation %}" 
                   class="btn btn-outline-primary btn-sm">
                    <i class="ri-edit-line me-1"></i>Modifier les informations
                </a>
                <a href="{% url 'administration:individual_vehicle_list' %}" 
                   class="btn btn-outline-secondary btn-sm">
                    <i class="ri-list-check me-1"></i>Retour à la liste
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmationInput = document.getElementById('confirmationInput');
    const deleteButton = document.getElementById('deleteButton');
    const deleteForm = document.getElementById('deleteForm');
    const confirmationError = document.getElementById('confirmationError');
    const expectedPlate = '{{ object.plaque_immatriculation }}';
    
    // Real-time validation
    confirmationInput.addEventListener('input', function() {
        const inputValue = this.value.trim();
        
        if (inputValue === expectedPlate) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
            deleteButton.disabled = false;
            deleteButton.classList.remove('btn-secondary');
            deleteButton.classList.add('btn-danger-custom');
        } else {
            this.classList.remove('is-valid');
            if (inputValue.length > 0) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
            deleteButton.disabled = true;
            deleteButton.classList.remove('btn-danger-custom');
            deleteButton.classList.add('btn-secondary');
        }
    });
    
    // Form submission with final confirmation
    deleteForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (confirmationInput.value.trim() !== expectedPlate) {
            confirmationInput.classList.add('is-invalid');
            confirmationInput.focus();
            return;
        }
        
        // Final confirmation dialog
        if (confirm('DERNIÈRE CONFIRMATION: Êtes-vous absolument certain de vouloir supprimer ce véhicule? Cette action est IRRÉVERSIBLE.')) {
            // Show loading state
            deleteButton.innerHTML = '<i class="ri-loader-4-line me-2 spinner-border spinner-border-sm"></i>Suppression...';
            deleteButton.disabled = true;
            
            // Submit the form
            this.submit();
        }
    });
    
    // Prevent accidental page leave
    window.addEventListener('beforeunload', function(e) {
        if (confirmationInput.value.trim().length > 0) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    
    // Focus on confirmation input
    confirmationInput.focus();
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Escape key to cancel
    if (e.key === 'Escape') {
        window.location.href = '{% url "administration:individual_vehicle_detail" plaque=object.plaque_immatriculation %}';
    }
});
</script>
{% endblock %}