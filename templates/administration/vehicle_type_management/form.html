{% extends 'administration/base_admin.html' %}
{% load static %}

{% block title %}
    {% if object %}Modifier le Type de Véhicule{% else %}Ajouter un Type de Véhicule{% endif %}
{% endblock %}

{% block content %}
<!-- Page Title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">
                {% if object %}Modifier le Type de Véhicule{% else %}Ajouter un Type de Véhicule{% endif %}
            </h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="{% url 'administration:dashboard' %}">Tableau de bord</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'administration:vehicle_type_list' %}">Types de Véhicules</a></li>
                    <li class="breadcrumb-item active">
                        {% if object %}Modifier{% else %}Ajouter{% endif %}
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>

        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            {% if object %}Modifier "{{ object.nom }}"{% else %}Nouveau Type de Véhicule{% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="post" novalidate>
                            {% csrf_token %}
                            
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label for="{{ form.nom.id_for_label }}" class="form-label">
                                            Nom du Type <span class="text-danger">*</span>
                                        </label>
                                        {{ form.nom }}
                                        {% if form.nom.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.nom.errors.0 }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            Nom du type de véhicule (ex: Voiture, Moto, Camion)
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label for="{{ form.ordre_affichage.id_for_label }}" class="form-label">
                                            Ordre d'Affichage
                                        </label>
                                        {{ form.ordre_affichage }}
                                        {% if form.ordre_affichage.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.ordre_affichage.errors.0 }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            Ordre d'affichage dans les listes (plus petit = affiché en premier)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.description.id_for_label }}" class="form-label">
                                    Description
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.description.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    Description optionnelle du type de véhicule
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    {{ form.est_actif }}
                                    <label class="form-check-label" for="{{ form.est_actif.id_for_label }}">
                                        Type actif
                                    </label>
                                </div>
                                {% if form.est_actif.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.est_actif.errors.0 }}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    Les types inactifs ne seront pas disponibles lors de la création de nouveaux véhicules
                                </div>
                            </div>

                            <div class="text-end">
                                <a href="{% url 'administration:vehicle_type_list' %}" class="btn btn-secondary me-2">
                                    <i class="ri-arrow-left-line align-bottom"></i> Annuler
                                </a>
                                <button type="submit" class="btn btn-success">
                                    <i class="ri-save-line align-bottom me-1"></i>
                                    {% if object %}Mettre à jour{% else %}Créer{% endif %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Aide</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6 class="alert-heading">Conseils :</h6>
                            <ul class="mb-0">
                                <li>Utilisez des noms courts et clairs</li>
                                <li>L'ordre d'affichage détermine l'ordre dans les formulaires</li>
                                <li>Les types inactifs restent visibles pour les véhicules existants</li>
                                {% if object and object.vehicules.count > 0 %}
                                <li class="text-warning">
                                    <strong>Attention :</strong> Ce type est utilisé par {{ object.vehicules.count }} véhicule(s)
                                </li>
                                {% endif %}
                            </ul>
                        </div>

                        {% if object %}
                        <div class="mt-3">
                            <h6>Statistiques</h6>
                            <div class="d-flex justify-content-between">
                                <span>Véhicules utilisant ce type :</span>
                                <span class="fw-semibold">{{ object.vehicules.count }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Créé le :</span>
                                <span>{{ object.created_at|date:"d/m/Y" }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Modifié le :</span>
                                <span>{{ object.updated_at|date:"d/m/Y" }}</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus on the first input
    const firstInput = document.querySelector('input[type="text"]');
    if (firstInput) {
        firstInput.focus();
    }

    // Add Bootstrap classes to form fields
    const formControls = document.querySelectorAll('input, select, textarea');
    formControls.forEach(function(control) {
        if (!control.classList.contains('form-check-input')) {
            control.classList.add('form-control');
        }
    });

    // Handle form validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const nomField = document.querySelector('#id_nom');
        if (!nomField.value.trim()) {
            e.preventDefault();
            nomField.classList.add('is-invalid');
            nomField.focus();
        }
    });
});
</script>
{% endblock %}