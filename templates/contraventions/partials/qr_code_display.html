<!-- Affichage du code QR -->
<div class="qr-code-container text-center">
    <div class="mb-3">
        <img src="{{ qr_code_url }}" alt="Code QR" class="img-fluid" style="max-width: 200px;">
    </div>
    <div class="mb-3">
        <small class="text-muted">Scannez ce code pour accéder aux détails de la contravention</small>
    </div>
    
    <!-- Informations de la contravention encodées dans le QR -->
    <div class="card border">
        <div class="card-body">
            <h6 class="card-title">Informations de la contravention</h6>
            <div class="row g-2">
                <div class="col-6">
                    <small class="text-muted">Numéro PV:</small>
                    <div><strong>{{ contravention.numero_pv }}</strong></div>
                </div>
                <div class="col-6">
                    <small class="text-muted">Date:</small>
                    <div><strong>{{ contravention.date_heure_infraction|date:"d/m/Y" }}</strong></div>
                </div>
                <div class="col-6">
                    <small class="text-muted">Montant:</small>
                    <div><strong>{{ contravention.montant_amende_ariary|floatformat:0 }} Ar</strong></div>
                </div>
                <div class="col-6">
                    <small class="text-muted">Statut:</small>
                    <div><strong>{{ contravention.get_statut_display }}</strong></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Boutons d'action -->
    <div class="mt-3">
        <a href="{{ qr_code_url }}" class="btn btn-outline-primary btn-sm" download="qr_contravention_{{ contravention.numero_pv }}.png">
            <i class="ri-download-line me-1"></i>
            Télécharger le QR
        </a>
        
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="printQRCode()">
            <i class="ri-printer-line me-1"></i>
            Imprimer
        </button>
        
        <button type="button" class="btn btn-outline-success btn-sm" onclick="copyQRLink()">
            <i class="ri-links-line me-1"></i>
            Copier le lien
        </button>
    </div>
</div>

<script>
function printQRCode() {
    var printWindow = window.open('', '_blank', 'width=400,height=500');
    var qrImage = document.querySelector('.qr-code-container img').src;
    
    printWindow.document.write('<html><head><title>Code QR - {{ contravention.numero_pv }}</title>');
    printWindow.document.write('<style>body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }');
    printWindow.document.write('img { max-width: 100%; height: auto; }');
    printWindow.document.write('.info { margin-top: 20px; font-size: 12px; }');
    printWindow.document.write('</style></head><body>');
    printWindow.document.write('<h3>Contravention {{ contravention.numero_pv }}</h3>');
    printWindow.document.write('<img src="' + qrImage + '" alt="Code QR">');
    printWindow.document.write('<div class="info">');
    printWindow.document.write('<p><strong>Date:</strong> {{ contravention.date_heure_infraction|date:"d/m/Y H:i" }}</p>');
    printWindow.document.write('<p><strong>Montant:</strong> {{ contravention.montant_amende_ariary|floatformat:0 }} Ar</p>');
    printWindow.document.write('<p><strong>Statut:</strong> {{ contravention.get_statut_display }}</p>');
    printWindow.document.write('</div></body></html>');
    
    printWindow.document.close();
    printWindow.print();
}

function copyQRLink() {
    var qrUrl = '{{ public_url }}';
    
    // Créer un élément temporaire pour copier le texte
    var tempInput = document.createElement('input');
    tempInput.value = qrUrl;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    
    // Afficher une notification de succès
    alert('Lien copié dans le presse-papiers !');
}
</script>